!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";window.RevealChalkboard=window.RevealChalkboard||{id:"RevealChalkboard",init:function(e){t.call(this,e)},configure:function(e){configure(e)},toggleNotesCanvas:function(){toggleNotesCanvas()},toggleChalkboard:function(){toggleChalkboard()},colorIndex:function(){colorIndex()},colorNext:function(){colorNext()},colorPrev:function(){colorPrev()},clear:function(){clear()},reset:function(){reset()},resetAll:function(){resetAll()},updateStorage:function(){updateStorage()},getData:function(){return getData()},download:function(){download()}};var e=function(){var e;if(document.currentScript)e=document.currentScript.src;else{var t=document.querySelector('script[src$="/chalkboard/plugin.js"]');t&&(e=t.src)}return void 0===e?"":e.slice(0,e.lastIndexOf("/")+1)}();const t=function(t){var n,a,o,r=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){r=!0}}))}catch(e){}var i=!1,d=3,s=7,l=1,c=[!0,!1],u={src:e+"img/sponge.png",radius:20},h=[{color:"rgba(100,100,100,1)",cursor:"url("+e+"img/boardmarker-black.png), auto"},{color:"rgba(30,144,255, 1)",cursor:"url("+e+"img/boardmarker-blue.png), auto"},{color:"rgba(220,20,60,1)",cursor:"url("+e+"img/boardmarker-red.png), auto"},{color:"rgba(50,205,50,1)",cursor:"url("+e+"img/boardmarker-green.png), auto"},{color:"rgba(255,140,0,1)",cursor:"url("+e+"img/boardmarker-orange.png), auto"},{color:"rgba(150,0,20150,1)",cursor:"url("+e+"img/boardmarker-purple.png), auto"},{color:"rgba(255,220,0,1)",cursor:"url("+e+"img/boardmarker-yellow.png), auto"}],g=[{color:"rgba(255,255,255,0.5)",cursor:"url("+e+"img/chalk-white.png), auto"},{color:"rgba(96, 154, 244, 0.5)",cursor:"url("+e+"img/chalk-blue.png), auto"},{color:"rgba(237, 20, 28, 0.5)",cursor:"url("+e+"img/chalk-red.png), auto"},{color:"rgba(20, 237, 28, 0.5)",cursor:"url("+e+"img/chalk-green.png), auto"},{color:"rgba(220, 133, 41, 0.5)",cursor:"url("+e+"img/chalk-orange.png), auto"},{color:"rgba(220,0,220,0.5)",cursor:"url("+e+"img/chalk-purple.png), auto"},{color:"rgba(255,220,0,0.5)",cursor:"url("+e+"img/chalk-yellow.png), auto"}],f={cursor:"url("+e+"img/sponge.png), auto"},v={toggleNotesCanvas:{keyCode:67,key:"C",description:"Toggle notes canvas"},toggleChalkboard:{keyCode:66,key:"B",description:"Toggle chalkboard"},clear:{keyCode:46,key:"DEL",description:"Clear drawings on slide"},resetAll:{keyCode:8,key:"BACKSPACE",description:"Reset all drawings"},colorNext:{keyCode:88,key:"X",description:"Next color"},colorPrev:{keyCode:89,key:"Y",description:"Previous color"},download:{keyCode:68,key:"D",description:"Download drawings"}},m="chalkboard",p=[0,0],b=!0,y=!0,w=800,k=!1,E="broadcast",C=S(t.getConfig().chalkboard||{});if(C.keyBindings)for(var x in C.keyBindings)v[x]=C.keyBindings[x];function S(t){if((t.boardmarkerWidth||t.penWidth)&&(d=t.boardmarkerWidth||t.penWidth),t.chalkWidth&&(s=t.chalkWidth),t.chalkEffect&&(l=t.chalkEffect),t.rememberColor&&(c=t.rememberColor),t.eraser&&(u=t.eraser),t.boardmarkers&&(h=t.boardmarkers),t.chalks&&(g=t.chalks),t.theme&&(m=t.theme),"whiteboard"===m)n=["rgba(127,127,127,.1)",e+"img/whiteboard.png"],o=[se,se],a=[h,h],i={color:"rgb(127,127,255,0.1)",distance:40,width:2};else n=["rgba(127,127,127,.1)",e+"img/blackboard.png"],o=[se,le],a=[h,g],i={color:"rgb(50,50,10,0.5)",distance:80,width:2};(t.background&&(n=t.background),null!=t.grid&&(i=t.grid),null!=t.toggleChalkboardButton&&t.toggleChalkboardButton,null!=t.toggleNotesButton&&t.toggleNotesButton,null!=t.colorButtons&&(b=t.colorButtons),null!=t.boardHandle&&(y=t.boardHandle),t.transition&&(w=t.transition),null!=t.readOnly&&(k=t.readOnly),t.messageType&&(E=t.messageType),L&&(t.theme||t.background||t.grid))&&(document.getElementById(L[1].id).style.background='url("'+n[1]+'") repeat',ge(1),fe());return t}function O(e){document.querySelector("section[data-markdown]:not([data-markdown-parsed])")||document.querySelector("[data-load]:not([data-loaded])")||document.querySelector('code[data-line-numbers*="|"]')?(console.log("Wait for external sources to be loaded and code to be highlighted"),setTimeout(O,500,e)):e()}function D(e){null!==$?e():(console.log("Wait for drawings to be loaded"),setTimeout(D,500,e))}var L=[{id:"notescanvas"},{id:"chalkboard"}];K(0),K(1);var M=0,T=0,A=0,q=0,I=null,P=null,N=!1,B=!1,W=Date.now(),R={h:0,v:0},X=[[],[]],Y=null,H=null,j=!1;function z(e,t){e.style.cursor=t.cursor;var n=document.querySelector('.palette[data-mode="'+M+'"]');n&&(n.style.cursor=t.cursor)}function J(e,t){(!0===t||t>e.length)&&(t=e.length);var n=document.createElement("div");n.classList.add("palette");for(var a=document.createElement("ul"),o=0;o<t;o++){var r=document.createElement("li");r.setAttribute("data-color",o),r.innerHTML='<i class="fa fa-square"></i>',r.style.color=e[o].color,r.addEventListener("click",(function(e){for(var t=e.target;!t.hasAttribute("data-color");)t=t.parentElement;qe(parseInt(t.getAttribute("data-color")))})),r.addEventListener("touchstart",(function(e){for(var t=e.target;!t.hasAttribute("data-color");)t=t.parentElement;qe(parseInt(t.getAttribute("data-color")))})),a.appendChild(r)}var i=document.createElement("li");i.setAttribute("data-eraser","true");var d=document.createElement("img");return d.src=u.src,d.height="24",d.width="24",d.style.marginTop="10px",d.style.marginRight="0",d.style.marginBottom="0",d.style.marginLeft="0",i.appendChild(d),i.addEventListener("click",(function(e){qe(-1)})),i.addEventListener("touchstart",(function(e){qe(-1)})),a.appendChild(i),n.appendChild(a),n}function F(e){me(e,!0);var t=new CustomEvent(E);t.content={sender:"chalkboard-plugin",type:"selectboard",timestamp:Date.now()-W,mode:M,board:T},document.dispatchEvent(t)}function K(e){var o=document.createElement("div");if(o.id=L[e].id,o.classList.add("overlay"),o.classList.add("r-overlay"),o.setAttribute("data-prevent-swipe","true"),o.oncontextmenu=function(){return!1},z(o,a[e][p[e]]),L[e].width=window.innerWidth,L[e].height=window.innerHeight,L[e].scale=1,L[e].xOffset=0,L[e].yOffset=0,"0"==e){o.style.background="rgba(0,0,0,0)",o.style.zIndex=24,o.style.opacity=1,o.style.visibility="visible",o.style.pointerEvents="none",o.style["backdrop-filter"]="none",o.style["-webkit-backdrop-filter"]="none",document.querySelector(".slides");var i=t.getConfig().width/t.getConfig().height;if(L[e].width>L[e].height*i?L[e].xOffset=(L[e].width-L[e].height*i)/2:L[e].height>L[e].width/i&&(L[e].yOffset=(L[e].height-L[e].width/i)/2),b)(d=J(h,b)).dataset.mode=e,d.style.visibility="hidden",o.appendChild(d)}else{var d;if(o.style.background='url("'+n[e]+'") repeat',o.style.zIndex=26,o.style.opacity=0,o.style.visibility="hidden",b)(d=J(g,b)).dataset.mode=e,o.appendChild(d);if(y){var s=document.createElement("div");s.classList.add("boardhandle"),s.innerHTML='<ul><li><a id="previousboard" href="#" title="Previous board"><i class="fas fa-chevron-up"></i></a></li><li><a id="nextboard" href="#" title="Next board"><i class="fas fa-chevron-down"></i></a></li></ul>',s.querySelector("#previousboard").addEventListener("click",(function(e){e.preventDefault(),F(T-1)})),s.querySelector("#nextboard").addEventListener("click",(function(e){e.preventDefault(),F(T+1)})),s.querySelector("#previousboard").addEventListener("touchstart",(function(e){e.preventDefault(),F(T-1)})),s.querySelector("#nextboard").addEventListener("touchstart",(function(e){e.preventDefault(),F(T+1)})),o.appendChild(s)}}var l=document.createElement("canvas");l.width=L[e].width,l.height=L[e].height,l.setAttribute("data-chalkboard",e),z(l,a[e][p[e]]),o.appendChild(l),L[e].canvas=l,L[e].context=l.getContext("2d"),function(e){e.addEventListener("touchstart",(function(e){if(e.preventDefault(),!k&&e.target.getAttribute("data-chalkboard")==M){var t=L[M].scale,n=L[M].xOffset,a=L[M].yOffset,o=e.touches[0];A=o.pageX,q=o.pageY,p[M]<0?Ce((A-n)/t,(q-a)/t):Oe((A-n)/t,(q-a)/t)}}),!!r&&{passive:!1}),e.addEventListener("touchmove",(function(e){if(e.preventDefault(),N||B){var t,n=L[M].scale,a=L[M].xOffset,o=L[M].yOffset,r=e.touches[0];if(A=r.pageX,q=r.pageY,N)De((I-a)/n,(P-o)/n,(A-a)/n,(q-o)/n,p[M]),(t=new CustomEvent(E)).content={sender:"chalkboard-plugin",type:"draw",timestamp:Date.now()-W,mode:M,board:T,fromX:(I-a)/n,fromY:(P-o)/n,toX:(A-a)/n,toY:(q-o)/n,color:p[M]},document.dispatchEvent(t),I=A,P=q;else xe((A-a)/n,(q-o)/n),(t=new CustomEvent(E)).content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-W,mode:M,board:T,x:(A-a)/n,y:(q-o)/n},document.dispatchEvent(t)}}),!1),e.addEventListener("touchend",(function(e){e.preventDefault(),Le(),Se()}),!1),e.addEventListener("mousedown",(function(e){if(e.preventDefault(),!k&&e.target.getAttribute("data-chalkboard")==M){var t=L[M].scale,n=L[M].xOffset,a=L[M].yOffset;if(A=e.pageX,q=e.pageY,p[M]<0||2==e.button||1==e.button){p[M]>=0&&z(L[M].canvas,f),Ce((A-n)/t,(q-a)/t);var o=new CustomEvent(E);o.content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-W,mode:M,board:T,x:(A-n)/t,y:(q-a)/t},document.dispatchEvent(o)}else Oe((A-n)/t,(q-a)/t)}})),e.addEventListener("mousemove",(function(e){e.preventDefault();var t=L[M].scale,n=L[M].xOffset,a=L[M].yOffset;if(A=e.pageX,q=e.pageY,N||B){var o;t=L[M].scale,n=L[M].xOffset,a=L[M].yOffset;if(A=e.pageX,q=e.pageY,N)De((I-n)/t,(P-a)/t,(A-n)/t,(q-a)/t,p[M]),(o=new CustomEvent(E)).content={sender:"chalkboard-plugin",type:"draw",timestamp:Date.now()-W,mode:M,board:T,fromX:(I-n)/t,fromY:(P-a)/t,toX:(A-n)/t,toY:(q-a)/t,color:p[M]},document.dispatchEvent(o),I=A,P=q;else xe((A-n)/t,(q-a)/t),(o=new CustomEvent(E)).content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-W,mode:M,board:T,x:(A-n)/t,y:(q-a)/t},document.dispatchEvent(o)}})),e.addEventListener("mouseup",(function(e){e.preventDefault(),p[M]>=0&&z(L[M].canvas,a[M][p[M]]),(N||B)&&(Le(),Se())}))}(o),document.querySelector(".reveal").appendChild(o),L[e].container=o}var U=[{width:t.getConfig().width,height:t.getConfig().height,data:[]},{width:t.getConfig().width,height:t.getConfig().height,data:[]}],$=null;function G(e){var t=!1;try{for(var n=JSON.parse(e),a=0;a<n.length;a++)L[a].width==n[a].width&&L[a].height==n[a].height||(L[a].scale=Math.min(L[a].width/n[a].width,L[a].height/n[a].height),L[a].xOffset=(L[a].width-n[a].width*L[a].scale)/2,L[a].yOffset=(L[a].height-n[a].height*L[a].scale)/2),C.readOnly&&(L[a].container.style.cursor="default",L[a].canvas.style.cursor="default");t=!0,U=n}catch(e){console.warn("Cannot initialise storage!")}return t}function Q(e){e?(V(),H=null):(H&&clearTimeout(H),H=setTimeout(Q,1e3,!0))}function V(){var e=JSON.stringify(U);return C.storage&&sessionStorage.setItem(C.storage,e),e}function Z(e){e.time=Date.now()-W,1==M&&(e.board=T);for(var t=ee(),n=t.events.length;n>0&&e.time<t.events[n-1].time;)n--;t.events.splice(n,0,e),t.duration=Math.max(t.duration,Date.now()-W)+1,Q()}function _(){for(var e=0;e<2;e++)for(var t=U[e].data.length-1;t>=0;t--)0==U[e].data[t].events.length&&U[e].data.splice(t,1);return V()}function ee(e,n){null==n&&(n=M),e||(e=R);for(var a=0;a<U[n].data.length;a++)if(U[n].data[a].slide.h===e.h&&U[n].data[a].slide.v===e.v&&U[n].data[a].slide.f===e.f)return U[n].data[a];var o=Number(t.getCurrentSlide().getAttribute("data-pdf-page-number"));return U[n].data.push({slide:e,page:o,events:[],duration:0}),U[n].data[U[n].data.length-1]}function te(e){e||(e=R);for(var t=0,n=0;n<2;n++)for(var a=0;a<U[n].data.length;a++)if(U[n].data[a].slide.h===e.h&&U[n].data[a].slide.v===e.v&&U[n].data[a].slide.f===e.f){t=Math.max(t,U[n].data[a].duration);break}return t}C.storage&&($=G(sessionStorage.getItem(C.storage))),$||null==C.src||function(e){var t=new XMLHttpRequest;t.onload=function(){4===t.readyState&&404!=t.status?($=G(t.responseText),V(),console.log("Drawings loaded from file")):(C.readOnly=void 0,k=void 0,console.warn("Failed to get file "+e+". ReadyState: "+t.readyState+", Status: "+t.status),$=!1)},t.open("GET",e,!0);try{t.send()}catch(t){C.readOnly=void 0,k=void 0,console.warn("Failed to get file "+e+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+t),$=!1}}(C.src);var ne=/print-pdf/gi.test(window.location.search);function ae(){for(var e=t.getSlides(),n=0,a=0;a<e.length;a++){e[a].setAttribute("data-pdf-page-number",n.toString());for(var o=e[a].querySelectorAll(".fragment:not([data-fragment-index])").length,r=e[a].querySelectorAll(".fragment[data-fragment-index]"),i=0;i<r.length;i++)Number(r[i].getAttribute("data-fragment-index"))+1>o&&(o=Number(r[i].getAttribute("data-fragment-index"))+1);n+=o+1}}function oe(){if(0!=U[1].data.length){console.log("Create printout(s) for "+U[1].data.length+" slides"),L[0].container.style.opacity=0,L[0].container.style.visibility="hidden";var e=new Image;e.onload=function(){for(var n=t.getSlides(),a=U[1].data.length-1;a>=0;a--){console.log("Create printout for slide "+U[1].data[a].slide.h+"."+U[1].data[a].slide.v);var o=ie(ee(U[1].data[a].slide,1),e);de(n[U[1].data[a].page],o)}},e.src=n[1]}}function re(e,t,n){var a,o,r,i=t.findIndex((e=>e.board===n));if(-1===i){var d=(a=e,o=document.createElement("canvas"),r=o.getContext("2d"),o.width=a.width,o.height=a.height,r.drawImage(a,0,0),o);t.length?n<t[0].board?(i=0,t.unshift({board:n,canvas:d})):n>t[t.length-1].board&&(i=t.length,t.push({board:n,canvas:d})):(i=0,t.push({board:n,canvas:d}))}return t[i].canvas}function ie(e,n){var a=t.getConfig().width,r=t.getConfig().height,i=1,d=0,s=0;a==U[1].width&&r==U[1].height||(i=Math.min(a/U[1].width,r/U[1].height),d=(a-U[1].width*i)/2,s=(r-U[1].height*i)/2),M=1,T=0;var l=[],c=document.createElement("canvas");c.width=a,c.height=r;var u=c.getContext("2d");u.fillStyle=u.createPattern(n,"repeat"),u.rect(0,0,a,r),u.fill();for(var h=0;h<e.events.length;h++)switch(e.events[h].type){case"draw":o[1](re(c,l,T).getContext("2d"),d+e.events[h].x1*i,s+e.events[h].y1*i,d+e.events[h].x2*i,s+e.events[h].y2*i,s+e.events[h].color);break;case"erase":ce(re(c,l,T).getContext("2d"),d+e.events[h].x*i,s+e.events[h].y*i);break;case"selectboard":me(e.events[h].board);break;case"clear":re(c,l,T).getContext("2d").clearRect(0,0,a,r),re(c,l,T).getContext("2d").fill()}return l=l.sort(((e,t)=>e.board>t.board?1:-1)),M=0,l}function de(e,n){for(var a=e.parentElement.parentElement,o=e.parentElement.nextElementSibling,r=0;r<n.length;r++){var i=document.createElement("div");i.classList.add("pdf-page"),i.style.height=t.getConfig().height,i.append(n[r].canvas),null!=o?a.insertBefore(i,o):a.append(i)}}function se(e,t,n,a,o,r){null==r&&(r=p[M]),e.lineWidth=d,e.lineCap="round",e.strokeStyle=h[r].color,e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke()}function le(e,t,n,a,o,r){null==r&&(r=p[M]);var i=s;e.lineWidth=i,e.lineCap="round",e.fillStyle=g[r].color,e.strokeStyle=g[r].color;e.strokeStyle=e.strokeStyle.replace(/[\d\.]+\)$/g,"1)"),e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke();for(var d=Math.round(Math.sqrt(Math.pow(a-t,2)+Math.pow(o-n,2))/(5/i)),c=(a-t)/d,u=(o-n)/d,h=0;h<d;h++)if(l>.9*Math.random()){var f=n+h*u,v=t+h*c+(Math.random()-.5)*i*1.2,m=f+(Math.random()-.5)*i*1.2;e.clearRect(v,m,2*Math.random()+2,Math.random()+1)}}function ce(e,t,n){e.save(),e.beginPath(),e.arc(t+u.radius,n+u.radius,u.radius,0,2*Math.PI,!1),e.clip(),e.clearRect(t-1,n-1,2*u.radius+2,2*u.radius+2),e.restore(),1==M&&i&&function(e,t,n){var a=L[1].context;L[1].scale=Math.min(L[1].width/U[1].width,L[1].height/U[1].height),L[1].xOffset=(L[1].width-U[1].width*L[1].scale)/2,L[1].yOffset=(L[1].height-U[1].height*L[1].scale)/2;var o=L[1].scale;L[1].xOffset,L[1].yOffset;for(var r=i.distance*o,d=L[1].width/2-r/2-Math.floor((L[1].width-r)/2/r)*r,s=d+r*Math.ceil((e-n-d)/r);s<=d+r*Math.floor((e+n-d)/r);s+=r)a.beginPath(),a.lineWidth=i.width*o,a.lineCap="round",a.fillStyle=i.color,a.strokeStyle=i.color,a.moveTo(s,t-Math.sqrt(n*n-(e-s)*(e-s))),a.lineTo(s,t+Math.sqrt(n*n-(e-s)*(e-s))),a.stroke();for(var l=L[1].height/2-r/2-Math.floor((L[1].height-r)/2/r)*r,c=l+r*Math.ceil((t-n-l)/r);c<=l+r*Math.floor((t+n-l)/r);c+=r)a.beginPath(),a.lineWidth=i.width*o,a.lineCap="round",a.fillStyle=i.color,a.strokeStyle=i.color,a.moveTo(e-Math.sqrt(n*n-(t-c)*(t-c)),c),a.lineTo(e+Math.sqrt(n*n-(t-c)*(t-c)),c),a.stroke()}(t+u.radius,n+u.radius,u.radius)}function ue(){L[1].container.style.opacity=1,L[1].container.style.visibility="visible",M=1}function he(){L[1].container.style.opacity=0,L[1].container.style.visibility="hidden",I=null,P=null,M=0}function ge(e){0==e&&clearTimeout(Y),L[e].context.clearRect(0,0,L[e].width,L[e].height),1==e&&i&&fe()}function fe(){var e=L[1].context;L[1].scale=Math.min(L[1].width/U[1].width,L[1].height/U[1].height),L[1].xOffset=(L[1].width-U[1].width*L[1].scale)/2,L[1].yOffset=(L[1].height-U[1].height*L[1].scale)/2;var t=L[1].scale;L[1].xOffset,L[1].yOffset;for(var n=i.distance*t,a=L[1].width/2-n/2-Math.floor((L[1].width-n)/2/n)*n;a<L[1].width;a+=n)e.beginPath(),e.lineWidth=i.width*t,e.lineCap="round",e.fillStyle=i.color,e.strokeStyle=i.color,e.moveTo(a,0),e.lineTo(a,L[1].height),e.stroke();for(var o=L[1].height/2-n/2-Math.floor((L[1].height-n)/2/n)*n;o<L[1].height;o+=n)e.beginPath(),e.lineWidth=i.width*t,e.lineCap="round",e.fillStyle=i.color,e.strokeStyle=i.color,e.moveTo(0,o),e.lineTo(L[1].width,o),e.stroke()}function ve(e,t){e>=a[M].length&&(e=0),p[M]=e,p[M]<0?z(L[M].canvas,f):z(L[M].canvas,a[M][p[M]])}function me(e,t){T!=e&&(T=e,pe(e),t&&Z({type:"selectboard"}))}function pe(e){ge(1);for(var t=ee(R,1),n=0;n<t.events.length&&t.events[n].time<Date.now()-W;)e==t.events[n].board&&Ee(1,t.events[n],Date.now()-W),n++}var be=[];function ye(){var e=be.shift();switch(W=Date.now()-e.content.timestamp,M<e.content.mode?ue():M>e.content.mode&&he(),T!=e.content.board&&pe(T=e.content.board),e.content.type){case"showChalkboard":ue();break;case"closeChalkboard":he();break;case"erase":xe(e.content.x,e.content.y);break;case"draw":De(e.content.fromX,e.content.fromY,e.content.toX,e.content.toY,e.content.color);break;case"clear":Ae();break;case"selectboard":me(e.content.board,!0);break;case"resetSlide":Ie();break;case"init":U=e.content.storage;for(var t=0;t<2;t++)L[t].scale=Math.min(L[t].width/U[t].width,L[t].height/U[t].height),L[t].xOffset=(L[t].width-U[t].width*L[t].scale)/2,L[t].yOffset=(L[t].height-U[t].height*L[t].scale)/2;ge(0),ge(1),j||(Y=setTimeout(we,w,te(),0)),1==M&&0==e.content.mode&&setTimeout(he,w+50),0==M&&1==e.content.mode&&setTimeout(ue,w+50),M=e.content.mode,T=e.content.board}be.length>0?ye():Q()}function we(e,t){W=Date.now()-e,he(),M=0,T=0;for(var n=0;n<2;n++){ge(n);for(var a=ee(R,n),o=0;o<a.events.length&&a.events[o].time<Date.now()-W;)Ee(n,a.events[o],e),o++;for(;j&&o<a.events.length;)X[n].push(setTimeout(Ee,a.events[o].time-(Date.now()-W),n,a.events[o],e)),o++}null!=t&&(M=t),1==M&&ue()}function ke(){for(var e=0;e<2;e++){for(var t=0;t<X[e].length;t++)clearTimeout(X[e][t]);X[e]=[]}}function Ee(e,t,n){switch(t.type){case"open":n<=t.time?ue():M=1;break;case"close":n<t.time?he():M=0;break;case"clear":ge(e);break;case"selectboard":me(t.board);break;case"draw":!function(e,t,n){var a=L[e].context,r=L[e].scale,i=L[e].xOffset,d=L[e].yOffset;o[e](a,i+t.x1*r,d+t.y1*r,i+t.x2*r,d+t.y2*r,t.color)}(e,t);break;case"erase":!function(e,t,n){var a=L[e].context,o=L[e].scale,r=L[e].xOffset,i=L[e].yOffset;ce(a,r+t.x*o,i+t.y*o)}(e,t)}}function Ce(e,t){N=!1,B=!0,xe(e,t)}function xe(e,t){var n=L[M].context,a=L[M].scale,o=L[M].xOffset,r=L[M].yOffset;Z({type:"erase",x:e,y:t}),e*a+o>0&&t*a+r>0&&e*a+o<L[M].width&&t*a+r<L[M].height&&ce(n,e*a+o,t*a+r)}function Se(){B=!1}function Oe(e,t){N=!0,L[M].context;var n=L[M].scale,a=L[M].xOffset,o=L[M].yOffset;I=e*n+a,P=t*n+o}function De(e,t,n,a,r){var i=L[M].context,d=L[M].scale,s=L[M].xOffset,l=L[M].yOffset;Z({type:"draw",color:r,x1:e,y1:t,x2:n,y2:a}),e*d+s>0&&t*d+l>0&&e*d+s<L[M].width&&t*d+l<L[M].height&&n*d+s>0&&a*d+l>0&&n*d+s<L[M].width&&a*d+l<L[M].height&&o[M](i,e*d+s,t*d+l,n*d+s,a*d+l,r)}function Le(){N=!1}function Me(){var e=Date.now()-W;j||(e=te());for(var t=0;t<2;t++)L[t].width=window.innerWidth,L[t].height=window.innerHeight,L[t].canvas.width=L[t].width,L[t].canvas.height=L[t].height,L[t].context.canvas.width=L[t].width,L[t].context.canvas.height=L[t].height,L[t].scale=Math.min(L[t].width/U[t].width,L[t].height/U[t].height),L[t].xOffset=(L[t].width-U[t].width*L[t].scale)/2,L[t].yOffset=(L[t].height-U[t].height*L[t].scale)/2;we(e,M)}function Te(){if(1==M)k||Z({type:"close"}),he(),(e=new CustomEvent(E)).content={sender:"chalkboard-plugin",type:"closeChalkboard",timestamp:Date.now()-W,mode:0,board:T},document.dispatchEvent(e);else if(ue(),!k){var e;Z({type:"open"}),(e=new CustomEvent(E)).content={sender:"chalkboard-plugin",type:"showChalkboard",timestamp:Date.now()-W,mode:1,board:T},document.dispatchEvent(e);var t=0;c[M]&&(t=p[M]),ve(t)}}function Ae(){Z({type:"clear"}),ge(M)}function qe(e){k||ve(e)}function Ie(){var e;W=Date.now(),he(),ge(0),ge(1),M=1,(e=ee()).duration=0,e.events=[],M=0,(e=ee()).duration=0,e.events=[],V()}function Pe(e){if(e||confirm("Please confirm to delete chalkboard drawings on this slide!")){ke(),Ie();var t=new CustomEvent(E);t.content={sender:"chalkboard-plugin",type:"resetSlide",timestamp:Date.now()-W,mode:M,board:T},document.dispatchEvent(t)}}for(var x in document.addEventListener("received",(function(e){e.content&&"chalkboard-plugin"==e.content.sender&&(be.push(e),console.log(JSON.stringify(e))),1==be.length&&ye()})),document.addEventListener("welcome",(function(e){var t=new CustomEvent(E);t.content={sender:"chalkboard-plugin",recipient:e.id,type:"init",timestamp:Date.now()-W,storage:U,mode:M,board:T},document.dispatchEvent(t)})),document.addEventListener("seekplayback",(function(e){ke(),j&&0!=e.timestamp||we(e.timestamp)})),document.addEventListener("startplayback",(function(e){ke(),j=!0,we(e.timestamp)})),document.addEventListener("stopplayback",(function(e){j=!1,ke()})),document.addEventListener("startrecording",(function(e){Pe(!0),W=Date.now()})),t.addEventListener("pdf-ready",(function(e){D(oe)})),t.addEventListener("ready",(function(e){if(!ne){if(window.addEventListener("resize",Me),W=Date.now()-te(),R=t.getIndices(),j||we(te(),0),t.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}V(),O(ae)}})),t.addEventListener("slidechanged",(function(e){if(!ne&&(W=Date.now()-te(),R=t.getIndices(),he(),T=0,ge(0),ge(1),j||(Y=setTimeout(we,w,te(),0)),t.isAutoSliding())){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}})),t.addEventListener("fragmentshown",(function(e){if(!ne)if(W=Date.now()-te(),R=t.getIndices(),he(),T=0,ge(0),ge(1),t.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}else j||we(te(),0)})),t.addEventListener("fragmenthidden",(function(e){ne||(W=Date.now()-te(),R=t.getIndices(),he(),T=0,ge(0),ge(1),t.isAutoSliding()?document.dispatchEvent(new CustomEvent("stopplayback")):j||(we(te()),he()))})),t.addEventListener("autoslideresumed",(function(e){var t=new CustomEvent("startplayback");t.timestamp=0,document.dispatchEvent(t)})),t.addEventListener("autoslidepaused",(function(e){document.dispatchEvent(new CustomEvent("stopplayback")),we(te(),0)})),this.toggleNotesCanvas=function(){if(!k)if(1==M)Te(),notescanvas.style.background=n[0],notescanvas.style.pointerEvents="auto";else if("none"!=notescanvas.style.pointerEvents)b&&(notescanvas.querySelector(".palette").style.visibility="hidden"),notescanvas.style.background="rgba(0,0,0,0)",notescanvas.style.pointerEvents="none";else{b&&(notescanvas.querySelector(".palette").style.visibility="visible"),notescanvas.style.background=n[0],notescanvas.style.pointerEvents="auto";var e=0;p[M]&&(e=p[M]),ve(e)}},this.toggleChalkboard=Te,this.colorIndex=qe,this.colorNext=function(){if(!k){ve((p[M]=(p[M]+1)%a[M].length,p[M]))}},this.colorPrev=function(){if(!k){ve((p[M]=(p[M]+(a[M].length-1))%a[M].length,p[M]))}},this.clear=function(){if(!k){Ae();var e=new CustomEvent(E);e.content={sender:"chalkboard-plugin",type:"clear",timestamp:Date.now()-W,mode:M,board:T},document.dispatchEvent(e)}},this.reset=Pe,this.resetAll=function(e){if(e||confirm("Please confirm to delete all chalkboard drawings!")){ke(),W=Date.now(),ge(0),ge(1),1==M&&he(),U=[{width:t.getConfig().width,height:t.getConfig().height,data:[]},{width:t.getConfig().width,height:t.getConfig().height,data:[]}],C.storage&&sessionStorage.setItem(C.storage,null);var n=new CustomEvent(E);n.content={sender:"chalkboard-plugin",type:"init",timestamp:Date.now()-W,storage:U,mode:M,board:T},document.dispatchEvent(n)}},this.download=function(){var e=document.createElement("a");document.body.appendChild(e);try{e.download="chalkboard.json";var t=new Blob([_()],{type:"application/json"});e.href=window.URL.createObjectURL(t)}catch(t){t=String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),e.innerHTML+=" ("+t+")"}e.click(),document.body.removeChild(e)},this.updateStorage=V,this.getData=_,this.configure=S,v)v[x]&&t.addKeyBinding(v[x],RevealChalkboard[x]);return this}}));
